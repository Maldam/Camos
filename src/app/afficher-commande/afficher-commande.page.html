<meta charset="utf-8">
<ion-header>
  <ion-toolbar color='primary'>
    <ion-buttons id='retourCommandes' slot="start">
      <ion-back-button text=""></ion-back-button>
      <ion-title id='titre'>Commande</ion-title>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <form [formGroup]="form" novalidate>
    <ion-item>
      <ion-label position="floating">Numéro de commande : </ion-label>
      <p></p>
      <ion-input disabled='true'>{{commande.numeroCommande}}</ion-input>
    </ion-item>
    <ion-item (click)="choixClientModal()">
      <ion-label color='primary'>Changer de client</ion-label>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Nom</ion-label>
      <p></p>
      <ion-input disabled='true'>{{commande.nomClient}}</ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Pseudo</ion-label>
      <p></p>
      <ion-input disabled='true'>{{commande.pseudoClient}}</ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Numéro de TVA</ion-label>
      <p></p>
      <ion-input disabled='true'>{{commande.numeroTVAClient}}</ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Notes</ion-label>
      <ion-textarea formControlName='notesForm' type="text" inputmode="text" (click)="estChange=true"></ion-textarea>
        <ion-fab-button *ngIf='estChange' slot='end' color="success" (click)="updateCommande()">
          <ion-icon name="save"></ion-icon>
        </ion-fab-button>
      
    </ion-item>
  </form>
  <ion-item (click)="choixProduitModal()">
    <ion-label color='primary'>Ajouter un produit</ion-label>
  </ion-item>
  <ion-card *ngFor="let commandeProduit of commandesProduits">
    <ion-item-sliding>
      <ion-title id='titre'>{{commandeProduit.produitNom}}</ion-title>
      <ion-item>
        <ion-note>
          <ion-label position="floating">Quantité</ion-label>
          <ion-textarea [(ngModel)]='commandeProduit.quantite' type="number" inputmode="number"
            (change)="produitModifie(commandeProduit)">
          </ion-textarea>
        </ion-note>
        <ion-note>
          <ion-label position="floating">Prix</ion-label>
          <ion-textarea [(ngModel)]='commandeProduit.prix' type="number" inputmode="number"
            (change)="produitModifie(commandeProduit)">
          </ion-textarea>
        </ion-note>
        <ion-note>
          <ion-label position="floating">Réduction en %</ion-label>
          <ion-textarea [(ngModel)]='commandeProduit.pourcentageProduit' type="number" inputmode="number"
            (change)="produitModifie(commandeProduit)">
          </ion-textarea>
        </ion-note>
        <ion-note>
          <ion-label position="floating">Total HTVA</ion-label>
          <p></p>
          <ion-label>
            {{((commandeProduit.prix*commandeProduit.quantite-((commandeProduit.prix*commandeProduit.quantite)*commandeProduit.pourcentageProduit/100)).toFixed(2)).replace('.',',')}}
          </ion-label>
        </ion-note>
        <ion-note>
          <ion-label position="floating">TVA</ion-label>
          <p></p>
          <ion-label>{{commandeProduit.TVAProduit}} %</ion-label>
        </ion-note>
      </ion-item>
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteProduit(commandeProduit)">
          <ion-icon name="trash" slot="icon-only"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-card>
  <ion-item>
    <ion-label position="floating">Réduction sur le total</ion-label>
    <ion-textarea [(ngModel)]='commande.pourcentageTotal' type="number" inputmode="number"
      (change)="calculPrix(commande); updateCommande()">
    </ion-textarea>
  </ion-item>
  <ion-item>
    <ion-label>Total commande HTVA : {{(total.toFixed(2)).replace('.',',')}} €</ion-label>
  </ion-item>
  <ion-item>
    <ion-label>Total commande TVAC : {{(totalTVA.toFixed(2)).replace('.',',')}} €</ion-label>
  </ion-item>
  <ion-item>
    <ion-label>Date de la commande : {{commande.dateCommande | date: 'dd MMMM yyyy'}}</ion-label>
  </ion-item>
  <ion-item>
    <ion-label>Date de livraison : </ion-label>
    <ion-datetime [(ngModel)]='commande.dateLivraison' max="2099-12-31" displayFormat="DD MMMM YYYY"
      placeholder="Choisissez une date de livraison" (change)="estChange=true"></ion-datetime>
  </ion-item>
  <ion-item></ion-item>
  <ion-fab *ngIf="!archive" vertical="bottom" horizontal="start" slot="fixed">
    <ion-fab-button color="danger" (click)="removeCommande(commande)">
      <ion-icon name="trash"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-button *ngIf="pdf" (click)="genererPDF()" expand="block" color="primary">
    <ion-icon name="checkmark"></ion-icon>PDF
  </ion-button>
</ion-content>